This solution is based on the one handed in by BlackBlizzard.
